<% title "Characters" %>
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="/">Home</a>
      </li>
      <li class="breadcrumb-item"><%= link_to 'Dashboard', v1_dashboard_path %></li>
      <li class="breadcrumb-item active" aria-current="page">Characters</li>
    </ol>
  </nav>

  <h1>Characters</h1>
  <%= render 'shared/search_form', url: v1_campaign_characters_path(@campaign) %>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Classes</th>
        <th>Race</th>
        <th>Player</th>
        <th>Campaign</th>
        <th>Guild</th>
        <th></th>
      </tr>
    </thead>

    <tbody>
      <% @characters.each do |character| %>
        <tr class="<%= character.type == 'PlayerCharacter' ? '' : 'table-danger' %>">
          <td><%= character.name %><%= " - #{character.role}" if character.role %></td>
          <td><%= character.character_classes.map {|character_class| "#{character_class.dnd_class.name} - #{character_class.level}"}.join(', ') %></td>
          <td><%= character.race %></td>
          <td><%= character.user.name %></td>
          <td><%= character.guild.campaign.name %></td>
          <td><%= character.guild.name %></td>
          <td>
            <%= link_to 'Show',  v1_campaign_guild_character_path(@campaign, @guild, character), class: "btn btn-sm btn-primary" %>
            <%= link_to 'Edit', edit_v1_campaign_guild_character_path(@campaign, @guild, character), class: "btn btn-sm btn-success" if policy(character).edit? %>
            <%= link_to 'Destroy',  v1_campaign_guild_character_path(@campaign, @guild, character), class: "btn btn-sm btn-danger", method: :delete, data: { confirm: 'Are you sure?' } if policy(character).destroy? %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  <%== pagy_bootstrap_nav(@pagy) if @pagy.pages > 1 %>
  <%= link_to 'New Player Character', new_v1_player_character_path, class: "btn btn-lg btn-success" if policy(PlayerCharacter).new? %>
  <%= link_to 'New Non-player Character', new_v1_non_player_character_path(@campaign), class: "btn btn-lg btn-danger" if policy(NonPlayerCharacter).new? %>
  <%= link_to 'Generate NPC', v1_campaign_generate_npc_path(@campaign), class: "btn btn-lg btn-danger" if policy(Character).generate_npc? %>
