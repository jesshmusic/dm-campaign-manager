
<%= simple_form_for [:v1, @campaign, @character], validate: true do |form| %>
  <%= form.error_notification %>
  <%= form.error_notification message: form.object.errors[:base].to_sentence if form.object.errors[:base].present? %>
  <% @character.errors.full_messages.each do |msg| %>
                      <h4><%= msg %></h4>
                    <% end %>

  <div class="form-inputs">
    <%= form.hidden_field :type, value: 'PlayerCharacter' %>
    <div class="form-row">
      <div class="col">
        <%= form.input :name %>
        <button class="btn btn-sm btn-link" id="randomMaleNameButton">Random Male Name</button>
        <button class="btn btn-sm btn-link" id="randomFemaleNameButton">Random Female Name</button>
      </div>
      <div class="col">
        <%= form.input :background %>
      </div>
    </div>

    <%= render 'character_fields', form: form %>
  </div>

  <div class="form-actions">
    <%= form.button :submit, class: 'btn btn-success mb-3' %>
  </div>
<% end %>

<script>
  $(`#non_player_character_race_attributes_id`).select2({
    theme: "bootstrap"
  });
  $('#player_character_alignment').select2({
    theme: "bootstrap"
  });
  $('#player_character_magic_item_ids').select2({
    theme: "bootstrap"
  });
  $('#player_character_campaign_ids').select2({
    theme: "bootstrap"
  });

  $("#equipment_items_container").on('cocoon:after-insert', function(event, addedTask) {
    loadSelect2();
  });

  $("#skills_container").on('cocoon:after-insert', function(event, addedTask) {
    loadSelect2();
  });

  function loadSelect2() {
    $('#character_spell_cantrip_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_1st_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_2nd_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_3rd_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_4th_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_5th_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_6th_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_7th_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_8th_level_ids').select2({
      theme: "bootstrap"
    });
    $('#character_spell_9th_level_ids').select2({
      theme: "bootstrap"
    });
    $( ".equipment_item_item" ).select2({
      multiple: false,
      theme: "bootstrap"
    });
    $( ".skill-selection" ).select2({
      multiple: false,
      theme: "bootstrap"
    });
  }

  $('#randomMaleNameButton').on('click', function(event) {
    event.preventDefault();
    $.ajax({
      type: 'GET',
      url: '/v1/random_fantasy_name',
      data: {
        random_npc_gender: 'male'
      }
    }).done(function(response) {
      $('#player_character_name').val(response.name);
    });
  });

  $('#randomFemaleNameButton').on('click', function(event) {
    event.preventDefault();
    $.ajax({
      type: 'GET',
      url: '/v1/random_fantasy_name',
      data: {
        random_npc_gender: 'female'
      }
    }).done(function(response) {
      $('#player_character_name').val(response.name);
    });
  });
  loadSelect2();

</script>
