
<%= simple_form_for @treasure, validate: true do |form| %>
  <%= form.error_notification %>
  <%= form.error_notification message: form.object.errors[:base].to_sentence if form.object.errors[:base].present? %>

  <div class="form-inputs">
    <%= form.input :name %>
    <%= form.input :description %>
    <%= form.input :copper_pieces %>
    <%= form.input :silver_pieces %>
    <%= form.input :gold_pieces %>
    <%= form.input :platinum_pieces %>
    
    <%= form.hidden_field :user_id, value: form.object.user_id || current_user.id %>

    <div class="py-3" id="equipment_items_container">
      <h5>Equipment</h5>
      <%= form.simple_fields_for :equipment_items do |equipment_item_form| %>
        <%= render 'equipment_item_fields', f: equipment_item_form %>
      <% end %>
      <div class='links'>
        <%= link_to_add_association 'Add Equipment', form, :equipment_items, class: "btn btn-info" %>
      </div>
    </div>
    
    <%= form.association :magic_items %>
  </div>

  <div class="form-actions">
    <%= form.button :submit, class: 'btn btn-success mb-3' %>
  </div>
<% end %>

<script>
  $(document).ready(function() {
    function convertToSlug(text) {
      return text.toLowerCase().replace(/[^\w ]+/g,'').replace(/ +/g,'_');
    }
    $("#equipment_items_container").on('cocoon:after-insert', function(event, addedTask) {
      loadSelect2();
    });
    function loadSelect2() {
      $( "#treasure_item_ids" ).select2({
        theme: "bootstrap"
      });
      $( "#treasure_magic_item_ids" ).select2({
        theme: "bootstrap"
      });
      $( ".equipment_item_item" ).select2({
        multiple: false,
        theme: "bootstrap"
      });
    }
    
    loadSelect2();
    $( "#treasure_name" ).on('change', function(event) {
      var slugInput = $('treasure_slug');
      slugInput.val(convertToSlug($( "#treasure_name" ).val()));
    });
  });
</script>
